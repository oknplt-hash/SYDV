{% extends "base.html" %}

{% block title %}{{ agenda.title }} Raporu{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center flex-wrap gap-2 mb-3">
    <div>
        <h1 class="h4 mb-1">{{ agenda.title }} Raporu</h1>
        <p class="small text-muted mb-0">
            Toplanti Tarihi: {{ agenda.meeting_date | dateformat }} &middot;
            Kayit Sayisi: {{ report_rows|length }}
        </p>
    </div>
    <div class="d-flex gap-2">
        <a class="btn btn-outline-secondary" href="{{ url_for('edit_agenda', agenda_id=agenda.id) }}">Gundeme Don</a>
        <a class="btn btn-primary" href="{{ url_for('agenda_report_excel', agenda_id=agenda.id) }}">Excel'e Aktar</a>
    </div>
</div>

<section class="card shadow-sm border-0">
    <div class="card-header bg-white border-0">
        <h2 class="h5 mb-0">Gundem Basvurulari</h2>
    </div>
    <div class="card-body p-0">
        {% if report_rows %}
            <div class="table-responsive">
                <table class="table table-sm align-middle mb-0">
                    <thead class="table-light">
                        <tr>
                            <th scope="col">Dosya No</th>
                            <th scope="col">Ad Soyad</th>
                            <th scope="col">Basvuru Tarihi</th>
                            <th scope="col">Yardim Turu</th>
                            <th scope="col">Notlar</th>
                            <th scope="col">Sosyal Guvence</th>
                            <th scope="col">Hane Nufusu</th>
                            <th scope="col">Cocuk Sayisi</th>
                            <th scope="col">Ogrenci Sayisi</th>
                            <th scope="col">Hane Geliri</th>
                            <th scope="col">Kisi Basina Gelir</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for row in report_rows %}
                            <tr>
                                <td class="fw-semibold">{{ row.file_no }}</td>
                                <td>{{ row.full_name }}</td>
                                <td>{{ row.application_date and (row.application_date | dateformat) or '-' }}</td>
                                <td>{{ row.assistance_type or "-" }}</td>
                                <td>{{ row.notes or "-" }}</td>
                                <td>{{ row.social_security or "-" }}</td>
                                <td>{{ row.household_size or "-" }}</td>
                                <td>{{ row.children_count or "-" }}</td>
                                <td>{{ row.student_count or "-" }}</td>
                                <td>{{ row.household_income is not none and (row.household_income | currency) or '-' }}</td>
                                <td>{{ row.per_capita_income is not none and (row.per_capita_income | currency) or '-' }}</td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        {% else %}
            <div class="p-4 text-center text-muted">
                Bu gundeme ait goruntulenecek basvuru kaydi bulunmuyor.
            </div>
        {% endif %}
    </div>
</section>
{% endblock %}
